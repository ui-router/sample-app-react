var k=Object.defineProperty;var D=(a,r,s)=>r in a?k(a,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[r]=s;var l=(a,r,s)=>D(a,typeof r!="symbol"?r+"":r,s);import{l as F,M as d,F as j}from"./lodash-T9rU2TFC.js";import{c as p,r as h,P as i,i as b,j as e,U as v,a as y,b as x}from"./index-CZ4gKJcq.js";function S(a){let r=1;return(a.charAt(0)==="+"||a.charAt(0)==="-")&&(r=a.charAt(0)==="-"?-1:1,a=a.substring(1)),(s,t)=>{let n=0,o=s[a],c=t[a];return o<c&&(n=-1),o>c&&(n=1),n*r}}class P{proximalMessageId(r,s){let t=r.sort(S(p.sort)),n=t.findIndex(c=>c._id===s);var o=t.length>n+1?n+1:n-1;return o>=0?t[o]._id:void 0}}let u=new P;class N extends h.Component{constructor(s){super(s);l(this,"uiCanExit",()=>{if(this.canExit||F.isEqual(this.pristineMessage,this.state.message))return!0;var s="You have not saved this message.",t="Navigate away and lose changes?";return b.confirm(s,t,"Yes","No")});l(this,"gotoPreviousState",()=>{let s=this.props.transition,t=!!s.from().name,n=t?s.from():"mymessages.messagelist",o=t?s.params("from"):{};s.router.stateService.go(n,o)});l(this,"send",()=>{let s=this.state.message;d.save({...s,date:new Date,read:!0,folder:"sent"}).then(()=>this.canExit=!0).then(()=>this.gotoPreviousState())});l(this,"save",()=>{let s=this.state.message;d.save({...s,date:new Date,read:!0,folder:"drafts"}).then(()=>this.canExit=!0).then(()=>this.gotoPreviousState())});l(this,"handleChangeMessage",s=>t=>this.setState({message:{...this.state.message,[s]:t.target.value}}));this.pristineMessage={body:"",to:"",subject:"",from:p.emailAddress,...this.props.$stateParams.message},this.state={message:{...this.pristineMessage}}}render(){let s=this.state.message;return e.jsxs("div",{className:"compose",children:[e.jsxs("div",{className:"header",children:[e.jsxs("div",{className:"flex-h",children:[" ",e.jsx("label",{children:"Recipient"})," ",e.jsx("input",{type:"text",id:"to",name:"to",value:s.to,onChange:this.handleChangeMessage("to")})," "]}),e.jsxs("div",{className:"flex-h",children:[" ",e.jsx("label",{children:"Subject"})," ",e.jsx("input",{type:"text",id:"subject",name:"subject",value:s.subject,onChange:this.handleChangeMessage("subject")})," "]})]}),e.jsxs("div",{className:"body",children:[e.jsx("textarea",{name:"body",id:"body",value:s.body,cols:"30",rows:"20",onChange:this.handleChangeMessage("body")}),e.jsxs("div",{className:"buttons",children:[e.jsxs("button",{className:"btn btn-primary",onClick:this.gotoPreviousState,children:[e.jsx("i",{className:"fa fa-times-circle-o"}),e.jsx("span",{children:"Cancel"})]}),e.jsxs("button",{className:"btn btn-primary",onClick:this.save,children:[e.jsx("i",{className:"fa fa-save"}),e.jsx("span",{children:"Save as Draft"})]}),e.jsxs("button",{className:"btn btn-primary",onClick:this.send,children:[e.jsx("i",{className:"fa fa-paper-plane-o"}),e.jsx("span",{children:"Send"})]})]})]})]})}}l(N,"propTypes",{$stateParams:i.shape({message:i.object})});class C extends h.Component{render(){let r=this.props.folders.map(s=>e.jsx(v,{class:"selected",children:e.jsx("li",{className:"folder",children:e.jsx(y,{to:".messagelist",params:{folderId:s._id},children:e.jsxs("a",{children:[e.jsx("i",{className:"fa"}),s._id]})})})},s._id));return e.jsxs("div",{children:[e.jsxs("div",{className:"my-messages",children:[e.jsx("div",{className:"folderlist",children:e.jsx("ul",{className:"selectlist list-unstyled",children:r})}),e.jsx(x,{name:"messagelist",className:"messagelist"})]}),e.jsx(x,{name:"messagecontent"})]})}}l(C,"propTypes",{folders:i.arrayOf(i.object)});const _=(a="")=>({__html:a.split(/\n/).map(r=>`<p>${r}</p>`).join(`
`)}),E=(a,r)=>a+r.subject,f=(a,r)=>({from:r.to,to:r.from,subject:E(a,r),body:O(r)}),O=a=>`



---------------------------------------
Original message:
From: ${a.from}
Date: ${a.date}
Subject: ${a.subject}

${a.body}`;class M extends h.Component{constructor(s){super(s);l(this,"reply",()=>{let{message:s}=this.props,t=f("Re: ",s);this.stateService.go("mymessages.compose",{message:t})});l(this,"forward",()=>{let{message:s}=this.props,t=f("Fwd: ",s);delete t.to,this.stateService.go("mymessages.compose",{message:t})});l(this,"editDraft",()=>{let{message:s}=this.props;this.stateService.go("mymessages.compose",{message:s})});l(this,"remove",()=>{let{message:s}=this.props,t=this.props.nextMessageGetter(s._id),n=t?"mymessages.messagelist.message":"mymessages.messagelist",o={messageId:t};b.confirm("Delete?",void 0).then(()=>d.remove(s)).then(()=>this.stateService.go(n,o,{reload:"mymessages.messagelist"}))});this.actions=s.folder.actions.reduce((t,n)=>(t[n]=!0,t),{}),this.stateService=this.props.transition.router.stateService}componentWillReceiveProps(s){let t=s.message;t.read=!0,d.put(t)}render(){let{folder:s,message:t,nextMessageGetter:n}=this.props;return e.jsxs("div",{className:"message",children:[e.jsxs("div",{className:"header",children:[e.jsxs("div",{children:[e.jsx("h4",{children:t.subject}),e.jsxs("h5",{children:[t.from," ",e.jsx("i",{className:"fa fa-long-arrow-right"})," ",t.to]})]}),e.jsx("div",{className:"line2",children:e.jsxs("div",{children:[this.actions.edit?e.jsxs("button",{className:"btn btn-primary",onClick:this.editDraft,children:[e.jsx("i",{className:"fa fa-pencil"})," ",e.jsx("span",{children:"Edit Draft"})]}):null,this.actions.reply?e.jsxs("button",{className:"btn btn-primary",onClick:this.reply,children:[e.jsx("i",{className:"fa fa-reply"})," ",e.jsx("span",{children:"Reply"})]}):null,this.actions.forward?e.jsxs("button",{className:"btn btn-primary",onClick:this.forward,children:[e.jsx("i",{className:"fa fa-forward"})," ",e.jsx("span",{children:"Forward"})]}):null,this.actions.delete?e.jsxs("button",{className:"btn btn-primary",onClick:this.remove,children:[e.jsx("i",{className:"fa fa-close"})," ",e.jsx("span",{children:"Delete"})]}):null]})})]}),e.jsx("div",{className:"body",dangerouslySetInnerHTML:_(t.body)})]})}}l(M,"propTypes",{message:i.object,nextMessageGetter:i.func,folder:i.shape({actions:i.arrayOf(i.string)})});class $ extends h.Component{constructor(){super(...arguments);l(this,"handleClick",s=>{let{col:t,sort:n,onChangeSort:o}=this.props,c=n===`+${t}`?`-${t}`:`+${t}`;o(c)})}render(){let{col:s,label:t,sort:n}=this.props,o="";n==`+${s}`?o="fa-sort-asc":n==`-${s}`&&(o="fa-sort-desc");let c=e.jsx("i",{style:{paddingLeft:"0.25em"},className:"fa "+o});return e.jsxs("span",{onClick:this.handleClick,children:[t," ",c]})}}l($,"propTypes",{label:i.string,col:i.string,sort:i.string,onChangeSort:i.func});const T=[{label:"",name:"read"},{label:"Sender",name:"from"},{label:"Recipient",name:"to"},{label:"Subject",name:"subject"},{label:"Date",name:"date"}];class w extends h.Component{constructor(s){super(s);l(this,"colVisible",s=>this.props.columns.indexOf(s)!==-1);l(this,"changeSort",s=>this.setState({sort:s}));l(this,"formattedContent",(s,t)=>t==="date"?new Date(s[t]).toISOString().slice(0,10):t==="read"?s[t]?"":e.jsx("i",{className:"fa fa-circle",style:{fontSize:"50%"}}):s[t]);this.state={sort:p.sort}}render(){let{sort:s}=this.state,{messages:t}=this.props,n=T.filter(m=>this.colVisible(m.name)),o=n.map(m=>e.jsx("td",{children:e.jsx($,{label:m.label,col:m.name,sort:s,onChangeSort:this.changeSort})},m.name)),c=t.sort(S(s)).map(m=>e.jsx(v,{class:"active",children:e.jsx(y,{to:".message",params:{messageId:m._id},children:e.jsx("tr",{children:n.map(g=>e.jsx("td",{children:this.formattedContent(m,g.name)},g.name))})})},m._id));return e.jsxs("table",{children:[e.jsx("thead",{children:e.jsx("tr",{children:o})}),e.jsx("tbody",{children:c})]})}}l(w,"propTypes",{messages:i.arrayOf(i.object),columns:i.arrayOf(i.string)});class I extends h.Component{render(){let{folder:r,messages:s}=this.props;return e.jsx("div",{className:"messagelist",children:e.jsx("div",{className:"messages",children:e.jsx(w,{columns:r.columns,messages:s})})})}}l(I,"propTypes",{messages:i.arrayOf(i.object),folder:i.shape({columns:i.arrayOf(i.string)})});const A={name:"mymessages.compose",url:"/compose",params:{message:{}},views:{"!$default.$default":N}},R={parent:"app",name:"mymessages",url:"/mymessages",resolve:[{token:"folders",resolveFn:()=>j.all()}],redirectTo:"mymessages.messagelist",component:C,data:{requiresAuth:!0}},U={name:"mymessages.messagelist.message",url:"/:messageId",resolve:[{token:"message",deps:["$transition$"],resolveFn:a=>d.get(a.params().messageId)},{token:"nextMessageGetter",deps:["messages"],resolveFn:a=>u.proximalMessageId.bind(u,a)}],views:{"^.^.messagecontent":M}},q={name:"mymessages.messagelist",url:"/:folderId",params:{folderId:"inbox"},resolve:[{token:"folder",deps:["$transition$"],resolveFn:a=>j.get(a.params().folderId)},{token:"messages",deps:["folder"],resolveFn:a=>d.byFolder(a)}],views:{messagelist:I}},V=[A,U,q,R];export{V as states};
